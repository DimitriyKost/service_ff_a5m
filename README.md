Макрос создан для подсчета использованного филамента на 3Д принтере и извещении пользователя о необходимости технического обслуживания (ТО) принтера при достижении установленного заранее лимита.
Макрос создавал для принтера FlashForge Adventure 5M, но думаю подойдет и на других принтерах использующих klipper.

Установка:
1) Создаем файл service.cfg в клиппере и туда вставляем код макроса и сохраняем без перезапуска клиппера. (при необходимости изменить лимит меняем в строчке с текстом - VARIABLE=service_interval VALUE=500. вместо 500 ставим нужное число)
2) Добавляем в printer.cfg в начале файла, но после других [include] - [include service.cfg] правивльно указав путь до файла созданного в п.1 и сохраняем с перезапуском клиппера.
3) После перезапуска клиппера в консоли инициализируем переменные необходимые для сервиса вызвав в консоле команду - _INIT_VARIABLES
4) В конец макроса END_PRINT либо в настройках слайсера в G-код окончания печати вставляем вызов обновления переменных сервиса - UPDATE_FILAMENT_USAGE
5) При достижении указаного значения в перменной service_interval макрос выведет окно с предупреждением о необходимости проведения ТО
6) Проводим ТО и нажимаем на конпку ТЕХОБСЛУЖИВАНИЕ ПРОВЕДЕНО, либо если пришлось закрыть это окно для отключения принтера можно вызвать макрос из консоли - RESET_SERVICE_COUNTER
7) Для просмотра значения последней печати(до перезапуска клиппера) можно посмотреть в консоли - выводится по окончании, либо вызвав макрос - GET_FILAMENT_USED 
